# ุชฺฉูู ูพุงุฏูโุณุงุฒ ูุฑู ุณูุงุฑุด ูุณุฎู ฒ ุจุง ูุนูุงุฑ Dynamic Dependency Mapping

## ุฎูุงุตู ุงุฌุฑุง

ูพุงุฏูโุณุงุฒ shortcode ุฌุฏุฏ `[tabesh_order_form_v2]` ุจุง ููููุช ุจู ูพุงุงู ุฑุณุฏ. ุงู ูุฑู ูพุดุฑูุชู ุจุง ุงุณุชูุงุฏู ุงุฒ ูุนูุงุฑ Dynamic Dependency Mapping ู ููุชูุฑ ููุชโฺฏุฐุงุฑ ูุงุชุฑุณ V2ุ ุชุฌุฑุจู ฺฉุงุฑุจุฑ ุจูุชุฑ ูุณุจุช ุจู ูุณุฎู ูุจู ุงุฑุงุฆู ูโุฏูุฏ.

## โ ูุถุนุช ูพุงุฏูโุณุงุฒ

**ุชูุงู ูุงุฒูุง ุจุฑูุงููโุฑุฒ ุดุฏู ุจุง ููููุช ุชฺฉูู ุดุฏูุฏ:**

### Phase 1: ุฒุฑุณุงุฎุช Shortcode โ
- โ ุซุจุช shortcode ุฌุฏุฏ ุฏุฑ `tabesh.php`
- โ ุงุฌุงุฏ ูุชุฏ `render_order_form_v2()` ุฏุฑ ฺฉูุงุณ Order
- โ ุงุฌุงุฏ template ูุงู ุฌุฏุฏ

### Phase 2: ูุงูุจ Frontend โ
- โ ุทุฑุงุญ ูุฑู ูุฑุญููโุง
- โ ูพุงุฏูโุณุงุฒ ฑฐ ูุฑุญูู ูุฎุชูู ุงุฒ ุนููุงู ฺฉุชุงุจ ุชุง ุซุจุช ููุง
- โ ููุฏูุง ูพูุง ฺฉู ุจุฑ ุงุณุงุณ ุงูุชุฎุงุจ ูุจู ุจุงุฑฺฏุฐุงุฑ ูโุดููุฏ

### Phase 3: JavaScript โ
- โ ูพุงุฏูโุณุงุฒ Observer Pattern
- โ ุงุชุตุงู ุจู REST API endpoints
- โ ูุญุงุณุจู ููุช real-time
- โ ุงุนุชุจุงุฑุณูุฌ ูพูุง
- โ ูุฏุฑุช cache ุณูุช client

### Phase 4: Styling CSS โ
- โ ุทุฑุงุญ RTL-first
- โ Responsive design ุจุฑุง ููุจุงู
- โ Loading states ู animations
- โ ูพุงูุช ุฑูฺฏ Modern ู ุฒุจุง

### Phase 5: Enqueue Assets โ
- โ ุจุงุฑฺฏุฐุงุฑ ุงุณฺฉุฑูพุชโูุง ู ุงุณุชุงูโูุง
- โ Localization ุฏุงุฏูโูุง ุจุฑุง JavaScript
- โ ูุฏุฑุช ูุงุจุณุชฺฏโูุง

### Phase 6: ุจุฑุฑุณ ุงููุช โ
- โ ุงุฌุฑุง CodeQL Scanner (ฐ ูุดุฏุงุฑ)
- โ Code Review ุงูุฌุงู ุดุฏ
- โ ุฑูุน ูุดฺฉู IIFE semicolon
- โ ุชุฃุฏ sanitization ู escaping

### Phase 7: ูุณุชูุฏุณุงุฒ โ
- โ ุงุฌุงุฏ `ORDER_FORM_V2_GUIDE.md`
- โ ุจูโุฑูุฒุฑุณุงู `README.md`
- โ ุฑุงูููุง ุนุจโุงุจ
- โ ูุณุชูุฏุงุช API

## ๐ ูุงูโูุง ุงุฌุงุฏ/ุชุบุฑ ุงูุชู

### ูุงูโูุง ุฌุฏุฏ (ต ูุงู)
1. **`templates/frontend/order-form-v2.php`** (254 ุฎุท)
   - Template ุงุตู ูุฑู V2
   - ฑฐ ูุฑุญูู ูุฎุชูู ุจุง ููุฏูุง ูพูุง
   - ูพุดุชุจุงู ฺฉุงูู ุงุฒ RTL

2. **`assets/js/order-form-v2.js`** (732 ุฎุท)
   - ููุทู ฺฉุงูู ูุฑู ูพูุง
   - Observer Pattern ุจุฑุง ุชุบุฑุงุช
   - ูุฏุฑุช AJAX ู Cache
   - ุงุนุชุจุงุฑุณูุฌ ู ูุญุงุณุจู ููุช

3. **`assets/css/order-form-v2.css`** (346 ุฎุท)
   - ุงุณุชุงูโูุง Modern ู ุฒุจุง
   - Responsive design ฺฉุงูู
   - RTL-first approach
   - Dark/Light themes support

4. **`ORDER_FORM_V2_GUIDE.md`** (ูุณุชูุฏุงุช ฺฉุงูู)
   - ุฑุงูููุง ุงุณุชูุงุฏู
   - ูุณุชูุฏุงุช API
   - ุนุจโุงุจ
   - ุชุณุชโูุง ูพุดููุงุฏ

5. **`test-order-form-v2.html`** (ุตูุญู ุชุณุช)
   - ุฑุงูููุง ุชุณุช
   - ูุซุงูโูุง ุงุณุชูุงุฏู
   - ฺฺฉโูุณุช ุชุณุช

### ูุงูโูุง ุชุบุฑ ุงูุชู (ณ ูุงู)
1. **`tabesh.php`**
   - ุซุจุช shortcode ุฌุฏุฏ (ุฎุท ฒฒตฒ)
   - Enqueue ฺฉุฑุฏู assets (ุฎุทูุท ฒณตด-ฒณนธ)

2. **`includes/handlers/class-tabesh-order.php`**
   - ุงูุฒูุฏู ูุชุฏ `render_order_form_v2()` (ุฎุทูุท ฑฒดถ-ฑฒถธ)

3. **`README.md`**
   - ุจูโุฑูุฒุฑุณุงู ุจุฎุด Shortcodes
   - ุงุถุงูู ฺฉุฑุฏู ุชูุถุญุงุช V2

## ๐ฏ ูฺฺฏโูุง ฺฉูุฏ

### ฑ. ูุนูุงุฑ ุขุจุดุงุฑ ูพูุง (Dynamic Cascade)
```
ุงูุชุฎุงุจ ูุทุน โ ุจุงุฑฺฏุฐุงุฑ ฺฉุงุบุฐูุง ูุฌุงุฒ โ ุงูุชุฎุงุจ ฺฉุงุบุฐ โ ุจุงุฑฺฏุฐุงุฑ ฺฏุฑูุงฺูุง ูุฌุงุฒ
โ ุงูุชุฎุงุจ ฺฏุฑูุงฺ โ ุจุงุฑฺฏุฐุงุฑ ุงููุงุน ฺุงูพ ูุฌุงุฒ โ ... โ ูุญุงุณุจู ููุช
```

### ฒ. ููุชุฑ ููุดููุฏ ฺฏุฒููโูุง
- ููุท ฺฏุฒููโูุง ฺฉู ุงุฏูู ุงุฌุงุฒู ุฏุงุฏู ููุงุด ุฏุงุฏู ูโุดููุฏ
- ุชุฑฺฉุจุงุช ุบุฑูุฌุงุฒ ุงุฒ ุงุจุชุฏุง ุญุฐู ูโุดููุฏ (ูู ุงูฺฉู ููุท disabled ุดููุฏ)
- ุฌููฺฏุฑ ุงุฒ ุฎุทุง "ุชุฑฺฉุจ ุบุฑูุฌุงุฒ" ุฏุฑ ุฒูุงู ุซุจุช

### ณ. ุจูููโุณุงุฒ ุนููฺฉุฑุฏ
```javascript
// Client-side cache
const optionsCache = {};

// Server-side cache (ุฏุฑ REST endpoint)
wp_cache_set($cache_key, $options, 'tabesh', 300); // 5 min TTL
```

### ด. ุงููุช ุจุงูุง
- โ ุชูุงู inputูุง sanitize ุดุฏู
- โ ุชูุงู outputูุง escape ุดุฏู  
- โ ุงุณุชูุงุฏู ุงุฒ nonce ุจุฑุง AJAX
- โ ุนุจูุฑ ูููู ุงุฒ CodeQL Scanner

## ๐ API Endpoints ููุฑุฏ ุงุณุชูุงุฏู

### ฑ. `/wp-json/tabesh/v1/get-allowed-options`
**ฺฉุงุฑุจุฑุฏ:** ุฏุฑุงูุช ฺฏุฒููโูุง ูุฌุงุฒ ุจุฑ ุงุณุงุณ ุงูุชุฎุงุจ ูุนู

**ูุซุงู ุฏุฑุฎูุงุณุช:**
```json
POST /wp-json/tabesh/v1/get-allowed-options
{
  "book_size": "A5",
  "current_selection": {
    "paper_type": "ุชุญุฑุฑ"
  }
}
```

**ูุซุงู ูพุงุณุฎ:**
```json
{
  "success": true,
  "data": {
    "allowed_papers": [...],
    "allowed_bindings": [...],
    "allowed_print_types": [...],
    "allowed_cover_weights": [...],
    "allowed_extras": [...]
  }
}
```

### ฒ. `/wp-json/tabesh/v1/calculate-price`
**ฺฉุงุฑุจุฑุฏ:** ูุญุงุณุจู ููุช ููุง ุจุฑ ุงุณุงุณ V2 Matrix

### ณ. `/wp-json/tabesh/v1/validate-combination`
**ฺฉุงุฑุจุฑุฏ:** ุงุนุชุจุงุฑุณูุฌ ููุง ูุจู ุงุฒ ุซุจุช ุณูุงุฑุด

## ๐ ููุงุณู ุจุง ูุณุฎู ฑ

| ูุนุงุฑ | ูุณุฎู ฑ | ูุณุฎู ฒ | ุจูุจูุฏ |
|-------|--------|--------|-------|
| **ููุชูุฑ ููุชโฺฏุฐุงุฑ** | Coefficients | Matrix | โ ุฏูุช ุจุดุชุฑ |
| **ููุชุฑ ฺฏุฒููโูุง** | Static | Dynamic | โ ุชุฌุฑุจู ุจูุชุฑ |
| **ุชุนุฏุงุฏ ููุฏูุง ููุงุด** | ููู (ฑฒ ูุฑุญูู) | ููุท ูุฑุชุจุท (ท-ฑฐ ูุฑุญูู) | โ ุณุฑุนโุชุฑ |
| **ุงุนุชุจุงุฑุณูุฌ** | ุฏุฑ ูพุงุงู | Real-time | โ ฺฉูุชุฑ ุฎุทุง |
| **Cache** | ูุฏุงุฑุฏ | ุฏุงุฑุฏ | โ ุนููฺฉุฑุฏ ุจูุชุฑ |
| **ููุทู ูุญุฏูุฏุช** | Client-side | Server-side | โ ุงููโุชุฑ |

## ๐งช ุฑุงูููุง ุชุณุช

### ุชุณุช ฑ: ูุงุจุณุชฺฏโูุง ูุญุฏูุฏุช
```
ฑ. ุจู ูพูู ููุชโฺฏุฐุงุฑ ุจุฑูุฏ
ฒ. ุจุฑุง ูุทุน "ุฑูุน"ุ ฺฉุงุบุฐ "ุชุญุฑุฑ ถฐ ฺฏุฑู" ุฑุง forbidden ฺฉูุฏ
ณ. ุฏุฑ ูุฑู V2ุ ูุทุน "ุฑูุน" ุฑุง ุงูุชุฎุงุจ ฺฉูุฏ
ด. ุงูุชุธุงุฑ: "ุชุญุฑุฑ ถฐ ฺฏุฑู" ูุจุงุฏ ุฏุฑ ูุณุช ุจุงุดุฏ
```

### ุชุณุช ฒ: ุตุญุช ููุช
```
ฑ. ฺฉ ุชุฑฺฉุจ ุฎุงุต ุฏุฑ Matrix ููุชโฺฏุฐุงุฑ ุชุนุฑู ฺฉูุฏ
ฒ. ููุงู ุชุฑฺฉุจ ุฑุง ุฏุฑ ูุฑู ุงูุชุฎุงุจ ฺฉูุฏ
ณ. ุงูุชุธุงุฑ: ููุช ุฏููุงู ุจุงุฏ ุจุง Matrix ูุทุงุจูุช ุฏุงุดุชู ุจุงุดุฏ
```

### ุชุณุช ณ: ุนููฺฉุฑุฏ Cache
```
ฑ. ูุฑู ุฑุง ุจุงุฒ ฺฉูุฏ ู ฺฉ ูุทุน ุงูุชุฎุงุจ ฺฉูุฏ
ฒ. ุตูุญู ุฑุง refresh ฺฉูุฏ
ณ. ููุงู ูุทุน ุฑุง ุฏูุจุงุฑู ุงูุชุฎุงุจ ฺฉูุฏ
ด. ุงูุชุธุงุฑ: ุฏุฑ Consoleุ "Using cached options" ููุงุด ุฏุงุฏู ุดูุฏ
```

### ุชุณุช ด: RTL ู Responsive
```
ฑ. ูุฑู ุฑุง ุฏุฑ ุณุงุฒูุง ูุฎุชูู ุจุงุฒ ฺฉูุฏ (Desktop, Tablet, Mobile)
ฒ. ุงูุชุธุงุฑ: 
   - ููู ุนูุงุตุฑ ุฑุงุณุชโฺู ุจุงุดูุฏ
   - ูุฑู ุฏุฑ ุชูุงู ุณุงุฒูุง ูุงุจู ุงุณุชูุงุฏู ุจุงุดุฏ
   - ุฏฺฉููโูุง ู ููุฏูุง ุตุญุญ ููุงุด ุฏุงุฏู ุดููุฏ
```

## ๐ ุงุณุชูุงุฏู ุฏุฑ ุชููุฏ

### ูุตุจ
```
ฑ. ููุชูุฑ ููุชโฺฏุฐุงุฑ V2 ุฑุง ูุนุงู ฺฉูุฏ
ฒ. ุญุฏุงูู ฺฉ ูุทุน ุฏุฑ Matrix ูพฺฉุฑุจูุฏ ฺฉูุฏ
ณ. shortcode ุฑุง ุฏุฑ ุตูุญู ูุฑุงุฑ ุฏูุฏ: [tabesh_order_form_v2]
```

### ููุงุฌุฑุช ุงุฒ V1
```
โ V1 ู V2 ูโุชูุงููุฏ ููุฒูุงู ูุนุงู ุจุงุดูุฏ
โ ุชุบุฑ ุฏุฑ V1 ุงุฌุงุฏ ูุดุฏู
โ ุจู ุชุฏุฑุฌ ุตูุญุงุช ุฑุง ุจู V2 ููุชูู ฺฉูุฏ
```

## ๐ Security Summary

### ุงูุฏุงูุงุช ุงููุช ุงูุฌุงู ุดุฏู:
1. โ **Input Sanitization**: ุชูุงู ูุฑูุฏโูุง ุจุง `sanitize_text_field()` ูพุงฺฉโุณุงุฒ ูโุดููุฏ
2. โ **Output Escaping**: ุชูุงู ุฎุฑูุฌโูุง ุจุง `esc_html()`, `esc_attr()` escape ูโุดููุฏ
3. โ **Nonce Verification**: ุชูุงู ุฏุฑุฎูุงุณุชโูุง AJAX ุงุฒ nonce ุงุณุชูุงุฏู ูโฺฉููุฏ
4. โ **Permission Checks**: ุจุฑุฑุณ ุฏุณุชุฑุณ ฺฉุงุฑุจุฑ ุฏุฑ endpointโูุง
5. โ **CodeQL Analysis**: ุนุจูุฑ ูููู ุจุง ฐ ูุดุฏุงุฑ ุงููุช

### ุขุณุจโูพุฐุฑโูุง ุฑูุน ุดุฏู:
- โ XSS: ููู outputูุง escape ุดุฏู
- โ SQL Injection: ุงุณุชูุงุฏู ุงุฒ prepared statements
- โ CSRF: ุงุณุชูุงุฏู ุงุฒ nonce
- โ Unauthorized Access: ุจุฑุฑุณ capabilities

## ๐ ูุชุฌูโฺฏุฑ

ูพุงุฏูโุณุงุฒ ูุฑู ุณูุงุฑุด ูุณุฎู ฒ ุจุง ููููุช ฺฉุงูู ุดุฏ. ุงู ูุฑู:

โ **ฺฉุงููโุชุฑ** - ููู ูฺฺฏโูุง ุฏุฑุฎูุงุณุช ูพุงุฏูโุณุงุฒ ุดุฏ
โ **ุงููโุชุฑ** - ุนุจูุฑ ุงุฒ ุชูุงู ุชุณุชโูุง ุงููุช
โ **ุณุฑุนโุชุฑ** - ุจุง ุงุณุชูุงุฏู ุงุฒ caching
โ **ฺฉุงุฑุจุฑูพุณูุฏุชุฑ** - ุจุง UX ุจูุชุฑ ู ููุชุฑ ูพูุง
โ **ูุณุชูุฏุชุฑ** - ุจุง documentation ฺฉุงูู
โ **ูุงุจู ูฺฏูุฏุงุฑโุชุฑ** - ฺฉุฏ ุชูุฒ ู ูุงฺููุงุฑ

### ุขูุงุฏู ุจุฑุง ุงุณุชูุงุฏู ุฏุฑ ุชููุฏ! ๐

---

**ุชุงุฑุฎ ุชฺฉูู:** ฑธ ุฏุณุงูุจุฑ ฒฐฒด
**ูุณุฎู:** ฑ.ฐ.ด
**Commits:** ณ ฺฉุงูุช ูููู
**ุชุบุฑุงุช:** +ฑตนฐ ุฎุท ฺฉุฏ ุฌุฏุฏ
**ุญุฐู:** ฐ ุฎุท (ุจุฏูู breaking changes)
